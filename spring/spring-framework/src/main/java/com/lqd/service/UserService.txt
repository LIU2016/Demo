package com.lqd.service;

import com.lqd.repository.User;
import org.springframework.beans.factory.InitializingBean;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Lazy;
import org.springframework.context.annotation.Scope;
import org.springframework.jdbc.core.BeanPropertyRowMapper;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Service;
import javax.annotation.PostConstruct;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

/**
 * @ClassName UserService
 * @Description TODO
 * @Author lqd
 * @Date 2018/12/9 9:23
 * @Version 1.0
 **/
@Service
@Scope(value="singleton")
@Lazy
public class UserService implements InitializingBean
{
    public UserService()
    {
        System.out.println("UserService cinit");
    }

    @Autowired
    private JdbcTemplate jdbcTemplate ;

    public void saveUser(User user) throws Exception {
        jdbcTemplate.execute("insert into t_e_user(username,address,id) values" +
                " ('"+user.getUserName()+"','"+user.getAddress()+"',nextval('seq_t_e_user'))");
    }

    public List<User> getUserList()
    {
        return jdbcTemplate.query("select * from t_e_user",
                new BeanPropertyRowMapper<>(User.class));
    }

    @PostConstruct
    public void postConstruct(){
        System.out.println("postConstruct");
    }

    @Override
    public void afterPropertiesSet() throws Exception {
        System.out.println("afterPropertiesSet");
    }
}
